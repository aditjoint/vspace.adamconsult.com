<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ADAM Enterprise Signage - Admin Panel</title>
<!-- Cast SDK -->
<script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
<style>
:root { 
  --primary: #0d6efd; 
  --secondary: #6f42c1; 
  --success: #198754; 
  --danger: #dc3545; 
  --dark: #212529; 
  --light: #f8f9fa; 
  --gray: #6c757d;
  --background: #1a1a1a;
  --card-bg: #2d2d2d;
  --border: #404040;
}

* {
  box-sizing: border-box;
}

body { 
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--background); 
  color: var(--light); 
  margin: 0; 
  padding: 0; 
  min-height: 100vh;
  line-height: 1.6;
}

.container { 
  max-width: 1600px; 
  margin: 0 auto; 
  padding: 0;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

/* Header Styles */
.header { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  padding: 1rem 2rem; 
  background: linear-gradient(135deg, var(--primary), var(--secondary)); 
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  backdrop-filter: blur(10px);
  position: sticky;
  top: 0;
  z-index: 100;
}

.header-content {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.logo {
  height: 48px;
  width: 48px;
  background: white;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 1.5rem;
  color: var(--primary);
}

.header h1 { 
  font-size: 1.8rem; 
  color: white; 
  margin: 0; 
  font-weight: 600;
}

.controls { 
  display: flex; 
  gap: 0.75rem; 
  flex-wrap: wrap; 
}

.btn { 
  padding: 0.6rem 1.25rem; 
  border: none; 
  border-radius: 8px; 
  font-size: 0.95rem;
  font-weight: 500;
  cursor: pointer; 
  transition: all 0.2s ease;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.btn-primary {
  background: rgba(255,255,255,0.2);
  color: white;
}

.btn-primary:hover {
  background: rgba(255,255,255,0.3);
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.btn-success {
  background: var(--success);
  color: white;
}

.btn-success:hover {
  background: #157347;
}

.btn-danger {
  background: var(--danger);
  color: white;
}

.btn-danger:hover {
  background: #c82333;
}

.btn-secondary {
  background: var(--secondary);
  color: white;
}

.btn-secondary:hover {
  background: #5e37a6;
}

/* Main Content */
.main-content { 
  padding: 2rem; 
  flex: 1;
}

/* Filters */
.filters { 
  display: flex; 
  gap: 1.5rem; 
  margin: 1.5rem 0; 
  flex-wrap: wrap; 
  background: rgba(255,255,255,0.05); 
  padding: 1.5rem; 
  border-radius: 12px; 
  backdrop-filter: blur(10px);
  border: 1px solid var(--border);
}

.filter-group { 
  display: flex; 
  flex-direction: column;
  gap: 0.5rem; 
}

.filter-group label { 
  font-weight: 600; 
  color: rgba(255,255,255,0.9); 
  font-size: 0.9rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.filter-select { 
  padding: 0.75rem 1rem; 
  border: 2px solid var(--border); 
  border-radius: 8px; 
  background: rgba(255,255,255,0.1); 
  color: white; 
  font-size: 1rem;
  min-width: 180px;
  backdrop-filter: blur(5px);
  transition: all 0.2s ease;
}

.filter-select:focus {
  outline: none;
  border-color: var(--primary);
  background: rgba(255,255,255,0.15);
  box-shadow: 0 0 0 3px rgba(13,110,253,0.25);
}

/* 9x9 Grid Controls */
.grid-controls { 
  margin: 1.5rem 0; 
  padding: 1.5rem; 
  background: rgba(255,255,255,0.05); 
  border-radius: 12px; 
  backdrop-filter: blur(10px);
  border: 1px solid var(--border);
}

.grid-controls h3 { 
  margin: 0 0 1rem 0; 
  color: var(--primary); 
  font-size: 1.25rem;
  font-weight: 600;
}

.grid-url { 
  display: flex; 
  gap: 0.75rem; 
  margin-bottom: 0.75rem; 
  align-items: center; 
  padding: 0.75rem;
  background: rgba(255,255,255,0.05);
  border-radius: 8px;
}

.grid-url input { 
  flex: 1; 
  padding: 0.75rem 1rem; 
  border: 2px solid var(--border); 
  border-radius: 8px; 
  background: rgba(255,255,255,0.1); 
  color: white; 
  font-size: 1rem;
  backdrop-filter: blur(5px);
}

.grid-url button { 
  width: 60px; 
  height: 42px;
  padding: 0;
  background: var(--danger); 
  color: white;
  border-radius: 8px;
  font-size: 1.2rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.grid-url button:hover {
  background: #c82333;
}

.add-url-btn {
  background: var(--secondary);
  color: white;
  padding: 0.75rem 1.5rem;
  font-size: 0.95rem;
  width: auto;
}

.add-url-btn:hover {
  background: #5e37a6;
}

.grid-actions { 
  display: flex; 
  gap: 1rem; 
  margin-top: 1rem; 
  flex-wrap: wrap;
}

/* Devices Grid */
.devices-grid { 
  display: grid; 
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
  gap: 1.5rem; 
  margin-top: 1.5rem; 
}

/* Device Card */
.device-card { 
  background: var(--card-bg); 
  padding: 1.5rem; 
  border-radius: 12px; 
  transition: all 0.3s ease;
  border: 1px solid var(--border);
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.device-card:hover { 
  transform: translateY(-4px); 
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
  border-color: var(--primary);
}

.device-header { 
  display: flex; 
  justify-content: space-between; 
  margin-bottom: 1rem; 
  padding-bottom: 0.75rem; 
  border-bottom: 1px solid var(--border); 
}

.device-name { 
  font-size: 1.1rem; 
  font-weight: 600; 
  color: white;
  margin: 0;
}

.status { 
  padding: 0.4rem 0.8rem; 
  border-radius: 20px; 
  font-size: 0.8rem; 
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-online { 
  background: var(--success); 
  color: white;
}

.status-offline { 
  background: var(--danger); 
  color: white;
}

.device-info { 
  margin: 1rem 0; 
  font-size: 0.9rem; 
  color: rgba(255,255,255,0.7); 
  line-height: 1.6;
}

.device-info div {
  margin-bottom: 0.4rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.device-info strong {
  color: white;
  min-width: 80px;
  display: inline-block;
}

.content-assign { 
  margin-top: 1rem; 
  padding-top: 1rem; 
  border-top: 1px solid var(--border); 
}

.content-assign input { 
  width: 100%; 
  padding: 0.75rem 1rem; 
  border: 2px solid var(--border); 
  border-radius: 8px; 
  background: rgba(255,255,255,0.1); 
  color: white; 
  font-size: 1rem;
  margin: 0.5rem 0;
  backdrop-filter: blur(5px);
}

.content-assign input:focus {
  outline: none;
  border-color: var(--primary);
  background: rgba(255,255,255,0.15);
}

.cast-btn { 
  background: var(--success); 
  color: white; 
  padding: 0.75rem 1.5rem; 
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.95rem;
  font-weight: 500;
  width: 100%;
  transition: all 0.2s ease;
}

.cast-btn:hover {
  background: #157347;
  transform: translateY(-1px);
}

/* Footer */
.footer { 
  background: rgba(0,0,0,0.5); 
  color: rgba(255,255,255,0.7); 
  text-align: center; 
  padding: 1.5rem; 
  font-size: 0.9rem; 
  border-top: 1px solid var(--border); 
  margin-top: auto;
}
/* Configuration Management */
.config-group {
  margin: 1.5rem 0;
  padding: 1rem;
  background: rgba(255,255,255,0.05);
  border-radius: 12px;
  border: 1px solid var(--border);
}

.config-group h3 {
  margin: 0 0 1rem 0;
  color: var(--primary);
  font-size: 1.1rem;
}

.config-display {
  margin-top: 1.5rem;
  padding: 1rem;
  background: rgba(255,255,255,0.05);
  border-radius: 12px;
  border: 1px solid var(--border);
}

.config-display h3 {
  margin: 0 0 1rem 0;
  color: var(--primary);
  font-size: 1.1rem;
}

.config-display h4 {
  margin: 0 0 0.5rem 0;
  color: var(--secondary);
  font-size: 1rem;
}

.config-display ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.config-display li {
  padding: 4px 0;
  color: rgba(255,255,255,0.8);
  font-size: 0.9rem;
}

.config-display li::before {
  content: "• ";
  color: var(--primary);
}
/* Configuration Management */
.config-group {
  margin: 1.5rem 0;
  padding: 1rem;
  background: rgba(255,255,255,0.05);
  border-radius: 12px;
  border: 1px solid var(--border);
}

.config-group h3 {
  margin: 0 0 1rem 0;
  color: var(--primary);
  font-size: 1.1rem;
}

.config-display {
  margin-top: 1.5rem;
  padding: 1rem;
  background: rgba(255,255,255,0.05);
  border-radius: 12px;
  border: 1px solid var(--border);
}

.config-display h3 {
  margin: 0 0 1rem 0;
  color: var(--primary);
  font-size: 1.1rem;
}

.config-display h4 {
  margin: 0 0 0.5rem 0;
  color: var(--secondary);
  font-size: 1rem;
}

.config-display ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.config-display li {
  padding: 4px 0;
  color: rgba(255,255,255,0.8);
  font-size: 0.9rem;
}

.config-display li::before {
  content: "• ";
  color: var(--primary);
}

  
</style>
</head>
<body>
<!-- Header -->
<header class="header">
  <div class="header-content">
    <div class="logo">A</div>
    <h1>ADAM Enterprise Signage</h1>
  </div>
  <div class="controls">
    <button class="btn btn-primary" onclick="refreshDevices()">
      <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
        <path d="M8 4.466V.534a.5.5 0 0 0-1 0v3.932a.5.5 0 0 0 1 0z"/>
      </svg>
      Refresh
    </button>
    <button class="btn btn-success" onclick="castToWall()">
      <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
      </svg>
      Cast to Wall
    </button>
    <button class="btn btn-secondary" onclick="syncAll()">
      <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
        <path d="M7.646 1.646a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 3.207V13.5a.5.5 0 0 1-1 0V3.207L5.354 5.354a.5.5 0 1 1-.708-.708l3-3z"/>
      </svg>
      Sync All
    </button>
  </div>
</header>

<!-- Main Content -->
<div class="container">
  <div class="main-content">
    <div class="filters">
      <div class="filter-group">
        <label for="stateFilter">State</label>
        <select id="stateFilter" class="filter-select" onchange="filterDevices()">
          <option value="all">All States</option>
          <option value="Maharashtra">Maharashtra</option>
          <option value="Tamil Nadu">Tamil Nadu</option>
          <option value="Karnataka">Karnataka</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="regionFilter">Region</label>
        <select id="regionFilter" class="filter-select" onchange="filterDevices()">
          <option value="all">All Regions</option>
          <option value="Mumbai Metro">Mumbai Metro</option>
          <option value="Pune">Pune</option>
          <option value="Chennai">Chennai</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="locationFilter">Location</label>
        <select id="locationFilter" class="filter-select" onchange="filterDevices()">
          <option value="all">All Locations</option>
          <option value="Corporate Office">Corporate Office</option>
          <option value="Retail Store">Retail Store</option>
          <option value="Factory">Factory</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="languageFilter">Language</label>
        <select id="languageFilter" class="filter-select" onchange="filterDevices()">
          <option value="all">All Languages</option>
          <option value="en">English</option>
          <option value="hi">Hindi</option>
          <option value="mr">Marathi</option>
          <option value="ta">Tamil</option>
        </select>
      </div>
    </div>

    <!-- Configuration Management -->
<div class="section">
  <h2>System Configuration</h2>
  
  <!-- Add New State -->
  <div class="config-group">
    <h3>Add New State</h3>
    <div style="display: flex; gap: 10px; align-items: center;">
      <input type="text" id="newState" placeholder="Enter state name">
      <button onclick="addState()" class="btn btn-primary">Add State</button>
    </div>
  </div>
  
  <!-- Add New City/Town -->
  <div class="config-group">
    <h3>Add New City/Town</h3>
    <div style="display: flex; gap: 10px; align-items: center;">
      <select id="stateForCity" class="filter-select">
        <option value="">Select State</option>
      </select>
      <input type="text" id="newCity" placeholder="Enter city/town name">
      <button onclick="addCity()" class="btn btn-primary">Add City</button>
    </div>
  </div>
  
  <!-- Add New Location Type -->
  <div class="config-group">
    <h3>Add New Location Type</h3>
    <div style="display: flex; gap: 10px; align-items: center;">
      <input type="text" id="newLocation" placeholder="Enter location type">
      <button onclick="addLocation()" class="btn btn-primary">Add Location</button>
    </div>
  </div>
  
  <!-- Add New Language -->
  <div class="config-group">
    <h3>Add New Language</h3>
    <div style="display: flex; gap: 10px; align-items: center;">
      <input type="text" id="newLanguageCode" placeholder="Language code (e.g., fr)">
      <input type="text" id="newLanguageName" placeholder="Language name (e.g., French)">
      <button onclick="addLanguage()" class="btn btn-primary">Add Language</button>
    </div>
  </div>
  
  <!-- Configuration Display -->
  <div class="config-display">
    <h3>Current Configuration</h3>
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 15px;">
      <div>
        <h4>States</h4>
        <ul id="statesList" style="margin: 5px 0; padding-left: 20px;"></ul>
      </div>
      <div>
        <h4>Cities/Towns</h4>
        <ul id="citiesList" style="margin: 5px 0; padding-left: 20px;"></ul>
      </div>
      <div>
        <h4>Location Types</h4>
        <ul id="locationsList" style="margin: 5px 0; padding-left: 20px;"></ul>
      </div>
      <div>
        <h4>Languages</h4>
        <ul id="languagesList" style="margin: 5px 0; padding-left: 20px;"></ul>
      </div>
    </div>
  </div>
</div>


    <!-- 9x9 Grid Controls -->
    <div class="grid-controls">
      <h3>9x9 Picture-in-Picture Grid</h3>
      <div id="gridUrls">
        <div class="grid-url">
          <input type="text" placeholder="Content URL for Tile 1 (e.g., YouTube, image, video)">
          <button onclick="removeUrl(0)">✕</button>
        </div>
      </div>
      <button onclick="addUrlField()">+ Add URL</button>
      <div class="grid-actions">
        <button onclick="castToGrid()">Cast to 9x9 Grid</button>
        <button onclick="castToGrid(true)">Cast to Grid with Fullscreen</button>
      <select id="fullscreenTile">
        <option value="0">Fullscreen Tile 1</option>
      </select>
    </div>
  </div>

  <div class="devices-grid" id="devicesGrid">
    <!-- Devices will be populated here -->
  </div>
</div>

<script>
// Cast variables
let castSession = null;
let currentCastDevice = null;

// Initialize Cast Framework
window['__onGCastApiAvailable'] = function(isAvailable) {
  if (isAvailable) {
    initializeCastApi();
  }
};

function initializeCastApi() {
  const context = cast.framework.CastContext.getInstance();
  context.setOptions({
    receiverApplicationId: chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,
    autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
  });

  context.addEventListener(
    cast.framework.CastContextEventType.SESSION_STATE_CHANGED,
    (event) => {
      switch (event.sessionState) {
        case cast.framework.SessionState.SESSION_STARTED:
          castSession = event.session;
          currentCastDevice = event.session.getCastDevice();
          console.log('Cast session started:', currentCastDevice.friendlyName);
          break;
        case cast.framework.SessionState.SESSION_ENDED:
          castSession = null;
          currentCastDevice = null;
          console.log('Cast session ended');
          break;
      }
    }
  );
}

function initializeCast() {
  const context = cast.framework.CastContext.getInstance();
  context.requestSession().then(
    () => {
      console.log('Cast session request successful');
    },
    (error) => {
      console.error('Error requesting cast session:', error);
      alert('Error connecting to device. Check that your Google TV is on the same network and Chromecast is enabled.');
    }
  );
}

// Add Cast button to header after DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
  // Only add if not already added
  if (!document.querySelector('.cast-btn-header')) {
    document.querySelector('.header').insertAdjacentHTML('beforeend', `
      <div style="margin-left: 20px;">
        <button onclick="initializeCast()" class="btn btn-primary cast-btn-header">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M15.985 8.5H13.61a4.5 4.5 0 0 0-8.922 0H2.015a.5.5 0 0 0-.494.57L3.977 16.1a.5.5 0 0 0 .494.4H11.53a.5.5 0 0 0 .494-.4l2.456-7.03a.5.5 0 0 0-.494-.57z"/>
            <path d="M10.5 8.5a2 2 0 1 1-4 0 2 2 0 0 1 4 0z"/>
          </svg>
          Cast
        </button>
      </div>
    `);
  }
});

// Mock device data - in production, this would come from API
const devices = [
  { id: 'DEV-001', name: 'Corporate Lobby Display', state: 'Maharashtra', region: 'Mumbai Metro', location: 'Corporate Office', language: 'en', status: 'online', ip: '192.168.1.101', model: 'Chromebox' },
  { id: 'DEV-002', name: 'Factory Floor Display', state: 'Maharashtra', region: 'Mumbai Metro', location: 'Factory', language: 'hi', status: 'online', ip: '192.168.1.102', model: 'Chromebit' },
  { id: 'DEV-003', name: 'Retail Store Window', state: 'Maharashtra', region: 'Pune', location: 'Retail Store', language: 'mr', status: 'online', ip: '192.168.1.103', model: 'Chromecast' },
  { id: 'DEV-004', name: 'Conference Room TV', state: 'Tamil Nadu', region: 'Chennai', location: 'Corporate Office', language: 'ta', status: 'offline', ip: '192.168.1.104', model: 'Chromecast' },
  { id: 'DEV-005', name: 'Cafeteria Display', state: 'Karnataka', region: 'Bangalore', location: 'Corporate Office', language: 'en', status: 'online', ip: '192.168.1.105', model: 'Chromebox' }
];

// Initialize devices grid
function initDevices() {
  const grid = document.getElementById('devicesGrid');
  grid.innerHTML = '';
  devices.forEach(device => {
    const card = document.createElement('div');
    card.className = 'device-card';
    card.innerHTML = `
      <div class="device-header">
        <strong>${device.name}</strong>
        <span class="status ${device.status}">${device.status}</span>
      </div>
      <div class="device-info">
        <div>ID: ${device.id}</div>
        <div>Model: ${device.model}</div>
        <div>IP: ${device.ip}</div>
        <div>Location: ${device.state}, ${device.region}, ${device.location}</div>
        <div>Language: ${device.language}</div>
      </div>
      <div class="content-assign">
        <input type="text" placeholder="Content URL or YouTube" id="content-${device.id}">
        <button onclick="assignContent('${device.id}')">Assign</button>
      </div>
      <button class="cast-wall" onclick="castToDevice('${device.id}')">Cast to Device</button>
    `;
    grid.appendChild(card);
  });
  
  // Initialize grid controls
  updateFullscreenOptions();
}

// Filter devices based on selections
function filterDevices() {
  const state = document.getElementById('stateFilter').value;
  const region = document.getElementById('regionFilter').value;
  const location = document.getElementById('locationFilter').value;
  const language = document.getElementById('languageFilter').value;
  
  const filtered = devices.filter(device => {
    return (state === 'all' || device.state === state) &&
           (region === 'all' || device.region === region) &&
           (location === 'all' || device.location === location) &&
           (language === 'all' || device.language === language);
  });
  
  const grid = document.getElementById('devicesGrid');
  grid.innerHTML = '';
  filtered.forEach(device => {
    const card = document.createElement('div');
    card.className = 'device-card';
    card.innerHTML = `
      <div class="device-header">
        <strong>${device.name}</strong>
        <span class="status ${device.status}">${device.status}</span>
      </div>
      <div class="device-info">
        <div>ID: ${device.id}</div>
        <div>Model: ${device.model}</div>
        <div>IP: ${device.ip}</div>
        <div>Location: ${device.state}, ${device.region}, ${device.location}</div>
        <div>Language: ${device.language}</div>
      </div>
      <div class="content-assign">
        <input type="text" placeholder="Content URL or YouTube" id="content-${device.id}">
        <button onclick="assignContent('${device.id}')">Assign</button>
      </div>
      <button class="cast-wall" onclick="castToDevice('${device.id}')">Cast to Device</button>
    `;
    grid.appendChild(card);
  });
}

<script>
// Configuration data - loaded from localStorage or defaults
let config = {
  states: ['Maharashtra', 'Tamil Nadu', 'Karnataka'],
  cities: {
    'Maharashtra': ['Mumbai', 'Pune', 'Nagpur'],
    'Tamil Nadu': ['Chennai', 'Coimbatore', 'Madurai'],
    'Karnataka': ['Bangalore', 'Mysore', 'Hubli']
  },
  locations: ['Corporate Office', 'Retail Store', 'Factory'],
  languages: {
    'en': 'English',
    'hi': 'Hindi',
    'mr': 'Marathi',
    'ta': 'Tamil'
  }
};

// Load configuration from localStorage
function loadConfig() {
  const savedConfig = localStorage.getItem('adamSignageConfig');
  if (savedConfig) {
    config = JSON.parse(savedConfig);
  }
  updateConfigDisplay();
  populateStateForCity();
}

// Save configuration to localStorage
function saveConfig() {
  localStorage.setItem('adamSignageConfig', JSON.stringify(config));
}

// Add new state
function addState() {
  const newState = document.getElementById('newState').value.trim();
  if (!newState) {
    alert('Please enter a state name');
    return;
  }
  
  if (config.states.includes(newState)) {
    alert('State already exists');
    return;
  }
  
  config.states.push(newState);
  config.cities[newState] = [];
  saveConfig();
  updateConfigDisplay();
  populateStateForCity();
  updateFilterOptions();
  
  document.getElementById('newState').value = '';
  alert(`State "${newState}" added successfully!`);
}

// Add new city/town
function addCity() {
  const state = document.getElementById('stateForCity').value;
  const newCity = document.getElementById('newCity').value.trim();
  
  if (!state) {
    alert('Please select a state');
    return;
  }
  
  if (!newCity) {
    alert('Please enter a city/town name');
    return;
  }
  
  if (config.cities[state].includes(newCity)) {
    alert('City/Town already exists for this state');
    return;
  }
  
  config.cities[state].push(newCity);
  saveConfig();
  updateConfigDisplay();
  updateFilterOptions();
  
  document.getElementById('newCity').value = '';
  alert(`City/Town "${newCity}" added to ${state} successfully!`);
}

// Add new location type
function addLocation() {
  const newLocation = document.getElementById('newLocation').value.trim();
  if (!newLocation) {
    alert('Please enter a location type');
    return;
  }
  
  if (config.locations.includes(newLocation)) {
    alert('Location type already exists');
    return;
  }
  
  config.locations.push(newLocation);
  saveConfig();
  updateConfigDisplay();
  updateFilterOptions();
  
  document.getElementById('newLocation').value = '';
  alert(`Location type "${newLocation}" added successfully!`);
}

// Add new language
function addLanguage() {
  const code = document.getElementById('newLanguageCode').value.trim().toLowerCase();
  const name = document.getElementById('newLanguageName').value.trim();
  
  if (!code || !name) {
    alert('Please enter both language code and name');
    return;
  }
  
  if (config.languages[code]) {
    alert('Language code already exists');
    return;
  }
  
  config.languages[code] = name;
  saveConfig();
  updateConfigDisplay();
  updateFilterOptions();
  
  document.getElementById('newLanguageCode').value = '';
  document.getElementById('newLanguageName').value = '';
  alert(`Language "${name}" (${code}) added successfully!`);
}

// Update configuration display
function updateConfigDisplay() {
  // Update states list
  const statesList = document.getElementById('statesList');
  statesList.innerHTML = '';
  config.states.forEach(state => {
    const li = document.createElement('li');
    li.textContent = state;
    statesList.appendChild(li);
  });
  
  // Update cities list
  const citiesList = document.getElementById('citiesList');
  citiesList.innerHTML = '';
  Object.keys(config.cities).forEach(state => {
    config.cities[state].forEach(city => {
      const li = document.createElement('li');
      li.textContent = `${city} (${state})`;
      citiesList.appendChild(li);
    });
  });
  
  // Update locations list
  const locationsList = document.getElementById('locationsList');
  locationsList.innerHTML = '';
  config.locations.forEach(location => {
    const li = document.createElement('li');
    li.textContent = location;
    locationsList.appendChild(li);
  });
  
  // Update languages list
  const languagesList = document.getElementById('languagesList');
  languagesList.innerHTML = '';
  Object.keys(config.languages).forEach(code => {
    const li = document.createElement('li');
    li.textContent = `${config.languages[code]} (${code})`;
    languagesList.appendChild(li);
  });
}

// Populate state dropdown for city addition
function populateStateForCity() {
  const select = document.getElementById('stateForCity');
  select.innerHTML = '<option value="">Select State</option>';
  
  config.states.forEach(state => {
    const option = document.createElement('option');
    option.value = state;
    option.textContent = state;
    select.appendChild(option);
  });
}

// Update filter options in the main interface
function updateFilterOptions() {
  // Update state filter
  const stateFilter = document.getElementById('stateFilter');
  const currentSelection = stateFilter.value;
  stateFilter.innerHTML = '<option value="all">All States</option>';
  
  config.states.forEach(state => {
    const option = document.createElement('option');
    option.value = state;
    option.textContent = state;
    stateFilter.appendChild(option);
  });
  
  // Restore selection if possible
  if (config.states.includes(currentSelection)) {
    stateFilter.value = currentSelection;
  }
  
  // Update location filter
  const locationFilter = document.getElementById('locationFilter');
  const currentLocation = locationFilter.value;
  locationFilter.innerHTML = '<option value="all">All Locations</option>';
  
  config.locations.forEach(location => {
    const option = document.createElement('option');
    option.value = location;
    option.textContent = location;
    locationFilter.appendChild(option);
  });
  
  // Restore selection if possible
  if (config.locations.includes(currentLocation)) {
    locationFilter.value = currentLocation;
  }
  
  // Update language filter
  const languageFilter = document.getElementById('languageFilter');
  const currentLanguage = languageFilter.value;
  languageFilter.innerHTML = '<option value="all">All Languages</option>';
  
  Object.keys(config.languages).forEach(code => {
    const option = document.createElement('option');
    option.value = code;
    option.textContent = config.languages[code];
    languageFilter.appendChild(option);
  });
  
  // Restore selection if possible
  if (config.languages[currentLanguage]) {
    languageFilter.value = currentLanguage;
  }
}

// Enhanced device setup with dynamic configuration
function openSetup() {
  // Create setup form in a popup
  const setupForm = `
    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;" id="setupOverlay">
      <div style="background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 500px;">
        <h2 style="color: #007bff; margin-top: 0;">Device Configuration</h2>
        
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">Device Name</label>
          <input type="text" id="setupDeviceName" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" value="${localStorage.getItem('deviceName') || ''}">
        </div>
        
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">State</label>
          <select id="setupState" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            ${config.states.map(state => `<option value="${state}" ${localStorage.getItem('state') === state ? 'selected' : ''}>${state}</option>`).join('')}
          </select>
        </div>
        
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">Region/City</label>
          <select id="setupRegion" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            ${(config.cities[localStorage.getItem('state')] || []).map(city => `<option value="${city}" ${localStorage.getItem('region') === city ? 'selected' : ''}>${city}</option>`).join('')}
          </select>
        </div>
        
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">Location</label>
          <select id="setupLocation" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            ${config.locations.map(location => `<option value="${location}" ${localStorage.getItem('location') === location ? 'selected' : ''}>${location}</option>`).join('')}
          </select>
        </div>
        
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">Language</label>
          <select id="setupLanguage" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            ${Object.keys(config.languages).map(code => `<option value="${code}" ${localStorage.getItem('language') === code ? 'selected' : ''}>${config.languages[code]}</option>`).join('')}
          </select>
        </div>
        
        <div style="display: flex; gap: 10px; margin-top: 20px;">
          <button onclick="saveSetup()" style="flex: 1; background: #007bff; color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer;">Save</button>
          <button onclick="closeSetup()" style="flex: 1; background: #6c757d; color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
        </div>
      </div>
    </div>
  `;
  
  document.body.insertAdjacentHTML('beforeend', setupForm);
  
  // Update region dropdown when state changes
  document.getElementById('setupState').addEventListener('change', function() {
    const state = this.value;
    const regionSelect = document.getElementById('setupRegion');
    regionSelect.innerHTML = '';
    
    if (state && config.cities[state]) {
      config.cities[state].forEach(city => {
        const option = document.createElement('option');
        option.value = city;
        option.textContent = city;
        regionSelect.appendChild(option);
      });
    }
  });
}

function saveSetup() {
  // Save to localStorage
  localStorage.setItem('deviceName', document.getElementById('setupDeviceName').value);
  localStorage.setItem('state', document.getElementById('setupState').value);
  localStorage.setItem('region', document.getElementById('setupRegion').value);
  localStorage.setItem('location', document.getElementById('setupLocation').value);
  localStorage.setItem('language', document.getElementById('setupLanguage').value);
  
  alert('Configuration saved! Restart the receiver to apply changes.');
  closeSetup();
}

function closeSetup() {
  const overlay = document.getElementById('setupOverlay');
  if (overlay) {
    overlay.remove();
  }
}

// Initialize configuration on load
document.addEventListener('DOMContentLoaded', function() {
  loadConfig();
});
</script>

  
// Assign content to specific device
function assignContent(deviceId) {
  const url = document.getElementById(`content-${deviceId}`).value.trim();
  if (!url) {
    alert('Please enter a URL');
    return;
  }
  // In production, this would send to API
  alert(`Content assigned to ${deviceId}: ${url}`);
}

// Cast to individual device
function castToDevice(deviceId) {
  const device = devices.find(d => d.id === deviceId);
  if (!device || device.status !== 'online') {
    alert('Device is offline or not found');
    return;
  }

  // Initialize cast if not already done
  if (!castSession) {
    initializeCast();
    alert('Please select your Chromecast device from the Google Cast icon that appeared.');
    return;
  }

  const contentUrl = document.getElementById(`content-${deviceId}`).value.trim();
  if (!contentUrl) {
    alert('Please enter a URL in the content field');
    return;
  }

  // Determine content type
  let contentType = 'video/mp4';
  if (contentUrl.match(/\.(jpeg|jpg|gif|png|bmp|webp)$/i)) {
    contentType = 'image/jpeg';
  } else if (contentUrl.match(/\.(mp3|wav|ogg)$/i)) {
    contentType = 'audio/mpeg';
  }

  const mediaInfo = new chrome.cast.media.MediaInfo(contentUrl, contentType);
  const request = new chrome.cast.media.LoadRequest(mediaInfo);
  request.autoplay = true;

  castSession.loadMedia(request).then(
    () => {
      alert(`Casting to ${device.name} (${device.id})`);
    },
    (error) => {
      console.error('Error loading media:', error);
      alert('Error casting content. Check the URL format and ensure the content is publicly accessible.');
    }
  );
}

// Cast to wall (all filtered devices)
function castToWall() {
  const state = document.getElementById('stateFilter').value;
  const region = document.getElementById('regionFilter').value;
  const location = document.getElementById('locationFilter').value;
  const language = document.getElementById('languageFilter').value;
  
  const filtered = devices.filter(device => {
    return (state === 'all' || device.state === state) &&
           (region === 'all' || device.region === region) &&
           (location === 'all' || device.location === location) &&
           (language === 'all' || device.language === language);
  });
  
  const onlineDevices = filtered.filter(d => d.status === 'online');
  if (onlineDevices.length === 0) {
    alert('No online devices found in the selected filters');
    return;
  }

  // Initialize cast if not already done
  if (!castSession) {
    initializeCast();
    alert('Please select your Chromecast device from the Google Cast icon that appeared.');
    return;
  }

  // For demo purposes, cast to the first online device
  const device = onlineDevices[0];
  const contentUrl = document.getElementById(`content-${device.id}`).value.trim();
  if (!contentUrl) {
    alert('Please enter a URL in the content field for at least one device');
    return;
  }

  const mediaInfo = new chrome.cast.media.MediaInfo(contentUrl, 'video/mp4');
  const request = new chrome.cast.media.LoadRequest(mediaInfo);
  request.autoplay = true;

  castSession.loadMedia(request).then(
    () => {
      alert(`Casting to wall: ${onlineDevices.length} devices (using ${device.name} as primary display)`);
    },
    (error) => {
      console.error('Error loading media:', error);
      alert('Error casting to wall');
    }
  );
}

// Add URL field for grid
function addUrlField() {
  const container = document.getElementById('gridUrls');
  const index = container.children.length;
  const div = document.createElement('div');
  div.className = 'grid-url';
  div.innerHTML = `
    <input type="text" placeholder="Content URL for Tile ${index + 1}">
    <button onclick="removeUrl(${index})">✕</button>
  `;
  container.appendChild(div);
  updateFullscreenOptions();
}

// Remove URL field
function removeUrl(index) {
  const container = document.getElementById('gridUrls');
  if (container.children.length > 1) {
    container.removeChild(container.children[index]);
    updateFullscreenOptions();
  }
}

// Update fullscreen tile options
function updateFullscreenOptions() {
  const select = document.getElementById('fullscreenTile');
  const container = document.getElementById('gridUrls');
  const count = container.children.length;
  
  // Save current selection
  const current = select.value;
  
  // Clear options
  select.innerHTML = '';
  
  // Add new options
  for (let i = 0; i < count; i++) {
    const option = document.createElement('option');
    option.value = i;
    option.textContent = `Fullscreen Tile ${i + 1}`;
    select.appendChild(option);
  }
  
  // Restore selection if possible
  if (current < count) {
    select.value = current;
  }
}

// Cast to 9x9 grid
function castToGrid(withFullscreen = false) {
  const urls = [];
  const container = document.getElementById('gridUrls');
  
  for (let i = 0; i < container.children.length; i++) {
    const input = container.children[i].querySelector('input');
    if (input.value.trim()) {
      urls.push(input.value.trim());
    }
  }
  
  if (urls.length === 0) {
    alert('Please add at least one URL');
    return;
  }
  
  // Initialize cast if not already done
  if (!castSession) {
    initializeCast();
    alert('Please select your Chromecast device from the Google Cast icon that appeared.');
    return;
  }

  const fullscreenTile = withFullscreen ? parseInt(document.getElementById('fullscreenTile').value) : undefined;
  
  const customData = {
    gridMode: 'pip9x9',
    urls: urls,
    timestamp: new Date().toISOString(),
    fullscreenTile: fullscreenTile
  };

  const mediaInfo = new chrome.cast.media.MediaInfo(
    window.location.origin + '/receiver.html',
    'text/html'
  );
  
  const request = new chrome.cast.media.LoadRequest(mediaInfo);
  request.customData = customData;

  castSession.loadMedia(request).then(
    () => {
      console.log('Grid loaded successfully');
      alert(`Grid cast successfully with ${urls.length} sources!`);
    },
    (error) => {
      console.error('Error loading grid:', error);
      alert('Error casting grid. Ensure receiver.html is properly hosted and accessible.');
    }
  );
}

// Refresh devices (simulated)
function refreshDevices() {
  // In production, this would fetch from API
  alert('Refreshing device status...');
}

// Sync all devices
function syncAll() {
  // In production, this would sync configuration
  alert('Syncing all devices...');
}

// Handle device registration from receivers
if (typeof BroadcastChannel !== 'undefined') {
  const channel = new BroadcastChannel('device-registration');
  channel.onmessage = function(event) {
    if (event.data.action === 'register') {
      // Add new device to the list
      const newDevice = {
        ...event.data.device,
        status: 'online'
      };
      
      // Check if device already exists
      const existingIndex = devices.findIndex(d => d.id === newDevice.deviceId);
      if (existingIndex >= 0) {
        // Update existing device
        devices[existingIndex] = newDevice;
      } else {
        // Add new device
        devices.push(newDevice);
      }
      
      // Refresh the device list
      initDevices();
      console.log('Device registered:', newDevice);
    }
  };
}
// Configuration data - loaded from localStorage or defaults
let config = {
  states: ['Maharashtra', 'Tamil Nadu', 'Karnataka'],
  cities: {
    'Maharashtra': ['Mumbai', 'Pune', 'Nagpur'],
    'Tamil Nadu': ['Chennai', 'Coimbatore', 'Madurai'],
    'Karnataka': ['Bangalore', 'Mysore', 'Hubli']
  },
  locations: ['Corporate Office', 'Retail Store', 'Factory'],
  languages: {
    'en': 'English',
    'hi': 'Hindi',
    'mr': 'Marathi',
    'ta': 'Tamil'
  }
};

// Load configuration from localStorage
function loadConfig() {
  const savedConfig = localStorage.getItem('adamSignageConfig');
  if (savedConfig) {
    config = JSON.parse(savedConfig);
  }
  updateConfigDisplay();
  populateStateForCity();
}

// Save configuration to localStorage
function saveConfig() {
  localStorage.setItem('adamSignageConfig', JSON.stringify(config));
}

// Add new state
function addState() {
  const newState = document.getElementById('newState').value.trim();
  if (!newState) {
    alert('Please enter a state name');
    return;
  }
  
  if (config.states.includes(newState)) {
    alert('State already exists');
    return;
  }
  
  config.states.push(newState);
  config.cities[newState] = [];
  saveConfig();
  updateConfigDisplay();
  populateStateForCity();
  updateFilterOptions();
  
  document.getElementById('newState').value = '';
  alert(`State "${newState}" added successfully!`);
}

// Add new city/town
function addCity() {
  const state = document.getElementById('stateForCity').value;
  const newCity = document.getElementById('newCity').value.trim();
  
  if (!state) {
    alert('Please select a state');
    return;
  }
  
  if (!newCity) {
    alert('Please enter a city/town name');
    return;
  }
  
  if (config.cities[state].includes(newCity)) {
    alert('City/Town already exists for this state');
    return;
  }
  
  config.cities[state].push(newCity);
  saveConfig();
  updateConfigDisplay();
  updateFilterOptions();
  
  document.getElementById('newCity').value = '';
  alert(`City/Town "${newCity}" added to ${state} successfully!`);
}

// Add new location type
function addLocation() {
  const newLocation = document.getElementById('newLocation').value.trim();
  if (!newLocation) {
    alert('Please enter a location type');
    return;
  }
  
  if (config.locations.includes(newLocation)) {
    alert('Location type already exists');
    return;
  }
  
  config.locations.push(newLocation);
  saveConfig();
  updateConfigDisplay();
  updateFilterOptions();
  
  document.getElementById('newLocation').value = '';
  alert(`Location type "${newLocation}" added successfully!`);
}

// Add new language
function addLanguage() {
  const code = document.getElementById('newLanguageCode').value.trim().toLowerCase();
  const name = document.getElementById('newLanguageName').value.trim();
  
  if (!code || !name) {
    alert('Please enter both language code and name');
    return;
  }
  
  if (config.languages[code]) {
    alert('Language code already exists');
    return;
  }
  
  config.languages[code] = name;
  saveConfig();
  updateConfigDisplay();
  updateFilterOptions();
  
  document.getElementById('newLanguageCode').value = '';
  document.getElementById('newLanguageName').value = '';
  alert(`Language "${name}" (${code}) added successfully!`);
}

// Update configuration display
function updateConfigDisplay() {
  // Update states list
  const statesList = document.getElementById('statesList');
  statesList.innerHTML = '';
  config.states.forEach(state => {
    const li = document.createElement('li');
    li.textContent = state;
    statesList.appendChild(li);
  });
  
  // Update cities list
  const citiesList = document.getElementById('citiesList');
  citiesList.innerHTML = '';
  Object.keys(config.cities).forEach(state => {
    config.cities[state].forEach(city => {
      const li = document.createElement('li');
      li.textContent = `${city} (${state})`;
      citiesList.appendChild(li);
    });
  });
  
  // Update locations list
  const locationsList = document.getElementById('locationsList');
  locationsList.innerHTML = '';
  config.locations.forEach(location => {
    const li = document.createElement('li');
    li.textContent = location;
    locationsList.appendChild(li);
  });
  
  // Update languages list
  const languagesList = document.getElementById('languagesList');
  languagesList.innerHTML = '';
  Object.keys(config.languages).forEach(code => {
    const li = document.createElement('li');
    li.textContent = `${config.languages[code]} (${code})`;
    languagesList.appendChild(li);
  });
}

// Populate state dropdown for city addition
function populateStateForCity() {
  const select = document.getElementById('stateForCity');
  select.innerHTML = '<option value="">Select State</option>';
  
  config.states.forEach(state => {
    const option = document.createElement('option');
    option.value = state;
    option.textContent = state;
    select.appendChild(option);
  });
}

// Update filter options in the main interface
function updateFilterOptions() {
  // Update state filter
  const stateFilter = document.getElementById('stateFilter');
  const currentSelection = stateFilter.value;
  stateFilter.innerHTML = '<option value="all">All States</option>';
  
  config.states.forEach(state => {
    const option = document.createElement('option');
    option.value = state;
    option.textContent = state;
    stateFilter.appendChild(option);
  });
  
  // Restore selection if possible
  if (config.states.includes(currentSelection)) {
    stateFilter.value = currentSelection;
  }
  
  // Update location filter
  const locationFilter = document.getElementById('locationFilter');
  const currentLocation = locationFilter.value;
  locationFilter.innerHTML = '<option value="all">All Locations</option>';
  
  config.locations.forEach(location => {
    const option = document.createElement('option');
    option.value = location;
    option.textContent = location;
    locationFilter.appendChild(option);
  });
  
  // Restore selection if possible
  if (config.locations.includes(currentLocation)) {
    locationFilter.value = currentLocation;
  }
  
  // Update language filter
  const languageFilter = document.getElementById('languageFilter');
  const currentLanguage = languageFilter.value;
  languageFilter.innerHTML = '<option value="all">All Languages</option>';
  
  Object.keys(config.languages).forEach(code => {
    const option = document.createElement('option');
    option.value = code;
    option.textContent = config.languages[code];
    languageFilter.appendChild(option);
  });
  
  // Restore selection if possible
  if (config.languages[currentLanguage]) {
    languageFilter.value = currentLanguage;
  }
}

// Initialize configuration on load
document.addEventListener('DOMContentLoaded', function() {
  loadConfig();
});


<!-- Configuration Management -->
<div class="section">
  <h2>System Configuration</h2>
  
  <!-- Add New State -->
  <div class="config-group">
    <h3>Add New State</h3>
    <div style="display: flex; gap: 10px; align-items: center;">
      <input type="text" id="newState" placeholder="Enter state name">
      <button onclick="addState()" class="btn btn-primary">Add State</button>
    </div>
  </div>
  
  <!-- Add New City/Town -->
  <div class="config-group">
    <h3>Add New City/Town</h3>
    <div style="display: flex; gap: 10px; align-items: center;">
      <select id="stateForCity" class="filter-select">
        <option value="">Select State</option>
      </select>
      <input type="text" id="newCity" placeholder="Enter city/town name">
      <button onclick="addCity()" class="btn btn-primary">Add City</button>
    </div>
  </div>
  
  <!-- Add New Location Type -->
  <div class="config-group">
    <h3>Add New Location Type</h3>
    <div style="display: flex; gap: 10px; align-items: center;">
      <input type="text" id="newLocation" placeholder="Enter location type">
      <button onclick="addLocation()" class="btn btn-primary">Add Location</button>
    </div>
  </div>
  
  <!-- Add New Language -->
  <div class="config-group">
    <h3>Add New Language</h3>
    <div style="display: flex; gap: 10px; align-items: center;">
      <input type="text" id="newLanguageCode" placeholder="Language code (e.g., fr)">
      <input type="text" id="newLanguageName" placeholder="Language name (e.g., French)">
      <button onclick="addLanguage()" class="btn btn-primary">Add Language</button>
    </div>
  </div>
  
  <!-- Configuration Display -->
  <div class="config-display">
    <h3>Current Configuration</h3>
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 15px;">
      <div>
        <h4>States</h4>
        <ul id="statesList" style="margin: 5px 0; padding-left: 20px;"></ul>
      </div>
      <div>
        <h4>Cities/Towns</h4>
        <ul id="citiesList" style="margin: 5px 0; padding-left: 20px;"></ul>
      </div>
      <div>
        <h4>Location Types</h4>
        <ul id="locationsList" style="margin: 5px 0; padding-left: 20px;"></ul>
      </div>
      <div>
        <h4>Languages</h4>
        <ul id="languagesList" style="margin: 5px 0; padding-left: 20px;"></ul>
      </div>
    </div>
  </div>
</div>




  
// Add setup link to header
document.querySelector('.header').insertAdjacentHTML('beforeend', `
  <div style="margin-left: 20px;">
    <button onclick="openSetup()" style="background: #6c757d;">Device Setup</button>
  </div>
`);

function openSetup() {
  // Create setup form in a popup
  const setupForm = `
    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;" id="setupOverlay">
      <div style="background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 500px;">
        <h2 style="color: #007bff; margin-top: 0;">Device Configuration</h2>
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">Device Name</label>
          <input type="text" id="setupDeviceName" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" value="${localStorage.getItem('deviceName') || ''}">
        </div>
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">State</label>
          <select id="setupState" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="Maharashtra" ${localStorage.getItem('state') === 'Maharashtra' ? 'selected' : ''}>Maharashtra</option>
            <option value="Tamil Nadu" ${localStorage.getItem('state') === 'Tamil Nadu' ? 'selected' : ''}>Tamil Nadu</option>
            <option value="Karnataka" ${localStorage.getItem('state') === 'Karnataka' ? 'selected' : ''}>Karnataka</option>
          </select>
        </div>
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">Region</label>
          <select id="setupRegion" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="Mumbai Metro" ${localStorage.getItem('region') === 'Mumbai Metro' ? 'selected' : ''}>Mumbai Metro</option>
            <option value="Pune" ${localStorage.getItem('region') === 'Pune' ? 'selected' : ''}>Pune</option>
            <option value="Chennai" ${localStorage.getItem('region') === 'Chennai' ? 'selected' : ''}>Chennai</option>
          </select>
        </div>
        <div style="margin-bottom: 15px;">
          <label style="display -- block; margin-bottom: 5px; font-weight: bold;">Location</label>
          <select id="setupLocation" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="Corporate Office" ${localStorage.getItem('location') === 'Corporate Office' ? 'selected' : ''}>Corporate Office</option>
            <option value="Retail Store" ${localStorage.getItem('location') === 'Retail Store' ? 'selected' : ''}>Retail Store</option>
            <option value="Factory" ${localStorage.getItem('location') === 'Factory' ? 'selected' : ''}>Factory</option>
          </select>
        </div>
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">Language</label>
          <select id="setupLanguage" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="en" ${localStorage.getItem('language') === 'en' ? 'selected' : ''}>English</option>
            <option value="hi" ${localStorage.getItem('language') === 'hi' ? 'selected' : ''}>Hindi</option>
            <option value="mr" ${localStorage.getItem('language') === 'mr' ? 'selected' : ''}>Marathi</option>
            <option value="ta" ${localStorage.getItem('language') === 'ta' ? 'selected' : ''}>Tamil</option>
          </select>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
          <button onclick="saveSetup()" style="flex: 1; background: #007bff; color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer;">Save</button>
          <button onclick="closeSetup()" style="flex: 1; background: #6c757d; color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
        </div>
      </div>
    </div>
  `;
  
  document.body.insertAdjacentHTML('beforeend', setupForm);
}

function saveSetup() {
  // Save to localStorage
  localStorage.setItem('deviceName', document.getElementById('setupDeviceName').value);
  localStorage.setItem('state', document.getElementById('setupState').value);
  localStorage.setItem('region', document.getElementById('setupRegion').value);
  localStorage.setItem('location', document.getElementById('setupLocation').value);
  localStorage.setItem('language', document.getElementById('setupLanguage').value);
  
  alert('Configuration saved! Restart the receiver to apply changes.');
  closeSetup();
}

function closeSetup() {
  const overlay = document.getElementById('setupOverlay');
  if (overlay) {
    overlay.remove();
  }
}
</script>

<!-- Footer -->
<footer class="footer">
  <p>ADAM Enterprise Signage System &copy; 2025 | 
     <a href="https://adamconsult.com" target="_blank">adamconsult.com</a> | 
     Version 1.0.0</p>
</footer>

<script>
// Initialize on load
window.onload = function() {
  initDevices();
  // Initialize Cast SDK
  if (window['__onGCastApiAvailable']) {
    window['__onGCastApiAvailable'](true);
  }
};
</script>

</body>
</html>


