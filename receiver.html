<!doctype html>
<html>
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Signage Receiver</title>
<style>
body{margin:0;background:#000;color:#fff;overflow:hidden}
#container{position:fixed;inset:0;display:grid;place-items:center}
.video-full{width:100%;height:100%;object-fit:cover}
.tile{width:50%;height:50%;object-fit:cover}
.grid2{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr;height:100vh}
</style>
<script src="https://www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
</head>
<body>
<div id="container"><div id="stage"></div></div>
<script>
const context = cast.framework.CastReceiverContext.getInstance();
const playerManager = context.getPlayerManager();

function createVideoEl(src, cls='video-full'){
  const v = document.createElement('video');
  v.className = cls;
  v.autoplay = true; v.muted = true; v.playsInline = true; v.src = src;
  return v;
}

function runPlaylistFromUrl(playlistUrl, playlistId){
  fetch(playlistUrl).then(r=>r.json()).then(data=>{
    const playlist = data[playlistId] || data.default;
    renderPlaylist(playlist);
  }).catch(e=>{ console.error('Failed to fetch playlist', e); });
}

function renderPlaylist(pl){
  const stage = document.getElementById('stage');
  stage.innerHTML = '';
  if(!pl) return;
  // simple: if single item -> fullscreen; if multiple tiles -> 2x2 grid using first 4
  if(pl.items.length === 1){
    const v = createVideoEl(pl.items[0].src, 'video-full');
    stage.appendChild(v);
  } else {
    const grid = document.createElement('div'); grid.className = 'grid2';
    pl.items.slice(0,4).forEach(it=>{
      const cls = 'tile';
      if(it.type === 'hls'){ // browser on Chromecast may support HLS natively; fallback may be required
        const v = createVideoEl(it.src, cls);
        grid.appendChild(v);
      } else {
        const v = createVideoEl(it.src, cls);
        grid.appendChild(v);
      }
    });
    stage.appendChild(grid);
  }
}

// Messaging namespace
const NAMESPACE = 'urn:x-cast:com.yourcompany.signage';
context.addCustomMessageListener(NAMESPACE, (event) => {
  const msg = event.data;
  if(msg.type === 'LOAD_PLAYLIST'){
    runPlaylistFromUrl(msg.playlistUrl, msg.playlistId);
  }
});

context.start();
</script>
</body>
</html>
